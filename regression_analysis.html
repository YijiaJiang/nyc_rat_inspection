<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Regression</title>

<script src="site_libs/header-attrs-2.17/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="icon" type="image/png" href="pic/rat.png"/>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NYC RAT INSPECTION</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="data_preprocessing.html">Data Preprocessing</a>
</li>
<li>
  <a href="exploratory_data_analysis.html">Exploratory Data Analysis</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Statistical Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="statistical_analysis.html">Hypothesis Test</a>
    </li>
    <li>
      <a href="regression_analysis.html">Regression Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="dashboard.html">Dashboard</a>
</li>
<li>
  <a href="https://lghtnpl.shinyapps.io/rat_app/">Shiny App</a>
</li>
<li>
  <a href="report.html">Report</a>
</li>
<li>
  <a href="https://youtube.com">
    <span class="fa fa-play-circle fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/YijiaJiang/nyc_rat_inspection">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Regression</h1>

</div>


<pre class="r"><code>library(tidyverse)
library(readxl)
library(car)</code></pre>
<pre class="r"><code>url_2012 = &quot;https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2012.csv&quot;
rat_2012 = read_csv(url(url_2012)) 
url_2013 = &quot;https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2013.csv&quot;
rat_2013 = read_csv(url(url_2013)) 
url_2014 = &quot;https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2014.csv&quot;
rat_2014 = read_csv(url(url_2014)) 
url_2015 = &quot;https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2015.csv&quot;
rat_2015 = read_csv(url(url_2015)) 
url_2016 = &quot;https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2016.csv&quot;
rat_2016 = read_csv(url(url_2016)) 
url_2017 = &quot;https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2017.csv&quot;
rat_2017 = read_csv(url(url_2017)) 
url_2018 = &quot;https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2018.csv&quot;
rat_2018 = read_csv(url(url_2018)) 
url_2019 = &quot;https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2019.csv&quot;
rat_2019 = read_csv(url(url_2019)) 
url_2020 = &quot;https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2020.csv&quot;
rat_2020 = read_csv(url(url_2020)) 
url_2021 = &quot;https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2021.csv&quot;
rat_2021 = read_csv(url(url_2021)) </code></pre>
<pre class="r"><code>rat = bind_rows(rat_2012, rat_2013, rat_2014, rat_2015, rat_2016, rat_2017, rat_2018, rat_2019, rat_2020, rat_2021) %&gt;%
  select(-...1) %&gt;%
   mutate(inspection_month_n = case_when(inspection_month == &quot;Jan&quot; ~ 1,
                                   inspection_month == &quot;Feb&quot; ~ 2,
                                   inspection_month == &quot;Mar&quot; ~ 3,
                                   inspection_month == &quot;Apr&quot; ~ 4,
                                   inspection_month == &quot;May&quot; ~ 5,
                                   inspection_month == &quot;Jun&quot; ~ 6,
                                   inspection_month == &quot;Jul&quot; ~ 7,
                                   inspection_month == &quot;Aug&quot; ~ 8,
                                   inspection_month == &quot;Sep&quot; ~ 9,
                                   inspection_month == &quot;Oct&quot; ~ 10,
                                   inspection_month == &quot;Nov&quot; ~ 11,
                                   inspection_month == &quot;Dec&quot; ~ 12)) %&gt;%
  mutate(date = paste(inspection_year, inspection_month_n, inspection_day, sep = &quot;-&quot;)) %&gt;%
  mutate(date = as.Date(date,format = &quot;%Y-%m-%d&quot;)) %&gt;% 
  mutate(inspection_ym = paste(inspection_year, inspection_month_n, sep = &quot;-&quot;)) %&gt;%
  mutate(covid_yn = case_when(date &lt; &quot;2020-02-29&quot; ~ 0,
                              TRUE ~ 1)) %&gt;%
  separate(inspection_time, into = c(&quot;hour&quot;, &quot;minute&quot;, &quot;second&quot;)) %&gt;%
  mutate(hour = as.numeric(hour)) %&gt;%
  mutate(inspection_daytime = case_when(
      hour &lt; 6 | hour &gt;= 18 ~ &quot;Night&quot;,
      hour &gt;= 6 &amp; hour &lt; 12 ~ &quot;Morning&quot;,
      hour &gt;= 12 &amp; hour &lt; 18 ~ &quot;Afternoon&quot;))
  
#%&gt;%  filter(result != &quot;Passed&quot;)</code></pre>
<div id="variable-selection" class="section level2">
<h2>Variable selection</h2>
<pre class="r"><code>cases = rat %&gt;% 
  select(borough, inspection_ym, inspection_month, covid_yn, prcp, snow, snwd, tmin, tmax) %&gt;% 
  group_by(inspection_ym, borough) %&gt;% 
  add_count(borough, inspection_ym, name = &quot;borough_monthly_cases&quot;) %&gt;%
  select(-prcp, -snow, -snwd, -tmin, -tmax)


rat_tidy = rat %&gt;% 
  select(borough, inspection_ym, inspection_month, covid_yn, prcp, snow, snwd, tmin, tmax) %&gt;%
  mutate(borough = as.factor(borough), 
         inspection_month = as.factor(inspection_month), 
         covid_yn = as.factor(covid_yn),
         prcp = as.numeric(prcp), 
         snow = as.numeric(snow), 
         snwd = as.numeric(snwd),
         tmin = as.numeric(tmin), 
         tmax = as.numeric(tmax)) %&gt;% 
  group_by(inspection_ym, borough) %&gt;% summarise(avg_prcp = mean(prcp),
                                                 avg_snow = mean(snow),
                                                 avg_snwd = mean(snwd),
                                                 avg_tmin = mean(tmin),
                                                 avg_tmax = mean(tmax))



cases_borough_monthly = merge(x = rat_tidy, y = cases, by = c(&quot;inspection_ym&quot;, &quot;borough&quot;)) %&gt;% distinct() </code></pre>
</div>
<div id="linear-regression-model" class="section level2">
<h2>Linear Regression Model</h2>
<pre class="r"><code>model_linear_original = lm(borough_monthly_cases ~ inspection_month + borough + covid_yn + avg_prcp + avg_snwd + avg_tmax, data = cases_borough_monthly) 
broom::tidy(model_linear_original) %&gt;% 
  knitr::kable()</code></pre>
<table>
<colgroup>
<col width="31%" />
<col width="19%" />
<col width="16%" />
<col width="17%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">4912.342411</td>
<td align="right">690.948650</td>
<td align="right">7.1095622</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">inspection_monthAug</td>
<td align="right">-23.708624</td>
<td align="right">574.662667</td>
<td align="right">-0.0412566</td>
<td align="right">0.9671056</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthDec</td>
<td align="right">-408.948839</td>
<td align="right">447.000465</td>
<td align="right">-0.9148734</td>
<td align="right">0.3606389</td>
</tr>
<tr class="even">
<td align="left">inspection_monthFeb</td>
<td align="right">-168.250123</td>
<td align="right">465.504627</td>
<td align="right">-0.3614360</td>
<td align="right">0.7179054</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthJan</td>
<td align="right">-1021.170949</td>
<td align="right">530.735292</td>
<td align="right">-1.9240683</td>
<td align="right">0.0548359</td>
</tr>
<tr class="even">
<td align="left">inspection_monthJul</td>
<td align="right">-292.080367</td>
<td align="right">617.836291</td>
<td align="right">-0.4727472</td>
<td align="right">0.6365717</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthJun</td>
<td align="right">-127.480948</td>
<td align="right">502.936261</td>
<td align="right">-0.2534734</td>
<td align="right">0.7999924</td>
</tr>
<tr class="even">
<td align="left">inspection_monthMar</td>
<td align="right">108.521903</td>
<td align="right">376.831554</td>
<td align="right">0.2879852</td>
<td align="right">0.7734611</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthMay</td>
<td align="right">-193.266177</td>
<td align="right">395.555234</td>
<td align="right">-0.4885947</td>
<td align="right">0.6253137</td>
</tr>
<tr class="even">
<td align="left">inspection_monthNov</td>
<td align="right">-650.755314</td>
<td align="right">361.284008</td>
<td align="right">-1.8012292</td>
<td align="right">0.0721869</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthOct</td>
<td align="right">-527.194309</td>
<td align="right">338.132663</td>
<td align="right">-1.5591345</td>
<td align="right">0.1195109</td>
</tr>
<tr class="even">
<td align="left">inspection_monthSep</td>
<td align="right">-343.007542</td>
<td align="right">472.702153</td>
<td align="right">-0.7256314</td>
<td align="right">0.4683579</td>
</tr>
<tr class="odd">
<td align="left">boroughBrooklyn</td>
<td align="right">-198.368456</td>
<td align="right">204.624897</td>
<td align="right">-0.9694248</td>
<td align="right">0.3327380</td>
</tr>
<tr class="even">
<td align="left">boroughManhattan</td>
<td align="right">233.942665</td>
<td align="right">203.727748</td>
<td align="right">1.1483103</td>
<td align="right">0.2513147</td>
</tr>
<tr class="odd">
<td align="left">boroughQueens</td>
<td align="right">-2998.955115</td>
<td align="right">204.860151</td>
<td align="right">-14.6390359</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">boroughStaten Island</td>
<td align="right">-3859.731482</td>
<td align="right">204.772334</td>
<td align="right">-18.8488914</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">covid_yn</td>
<td align="right">-1719.833539</td>
<td align="right">171.610234</td>
<td align="right">-10.0217423</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">avg_prcp</td>
<td align="right">36.227201</td>
<td align="right">28.719671</td>
<td align="right">1.2614072</td>
<td align="right">0.2076701</td>
</tr>
<tr class="odd">
<td align="left">avg_snwd</td>
<td align="right">-9.809817</td>
<td align="right">2.585363</td>
<td align="right">-3.7943671</td>
<td align="right">0.0001636</td>
</tr>
<tr class="even">
<td align="left">avg_tmax</td>
<td align="right">-9.622663</td>
<td align="right">38.201008</td>
<td align="right">-0.2518955</td>
<td align="right">0.8012112</td>
</tr>
</tbody>
</table>
<pre class="r"><code>summary(model_linear_original)</code></pre>
<pre><code>FALSE 
FALSE Call:
FALSE lm(formula = borough_monthly_cases ~ inspection_month + borough + 
FALSE     covid_yn + avg_prcp + avg_snwd + avg_tmax, data = cases_borough_monthly)
FALSE 
FALSE Residuals:
FALSE     Min      1Q  Median      3Q     Max 
FALSE -3616.5  -832.7  -181.4   865.6  6683.1 
FALSE 
FALSE Coefficients:
FALSE                       Estimate Std. Error t value Pr(&gt;|t|)    
FALSE (Intercept)           4912.342    690.949   7.110 3.44e-12 ***
FALSE inspection_monthAug    -23.709    574.663  -0.041 0.967106    
FALSE inspection_monthDec   -408.949    447.000  -0.915 0.360639    
FALSE inspection_monthFeb   -168.250    465.505  -0.361 0.717905    
FALSE inspection_monthJan  -1021.171    530.735  -1.924 0.054836 .  
FALSE inspection_monthJul   -292.080    617.836  -0.473 0.636572    
FALSE inspection_monthJun   -127.481    502.936  -0.253 0.799992    
FALSE inspection_monthMar    108.522    376.832   0.288 0.773461    
FALSE inspection_monthMay   -193.266    395.555  -0.489 0.625314    
FALSE inspection_monthNov   -650.755    361.284  -1.801 0.072187 .  
FALSE inspection_monthOct   -527.194    338.133  -1.559 0.119511    
FALSE inspection_monthSep   -343.008    472.702  -0.726 0.468358    
FALSE boroughBrooklyn       -198.368    204.625  -0.969 0.332738    
FALSE boroughManhattan       233.943    203.728   1.148 0.251315    
FALSE boroughQueens        -2998.955    204.860 -14.639  &lt; 2e-16 ***
FALSE boroughStaten Island -3859.731    204.772 -18.849  &lt; 2e-16 ***
FALSE covid_yn             -1719.834    171.610 -10.022  &lt; 2e-16 ***
FALSE avg_prcp                36.227     28.720   1.261 0.207670    
FALSE avg_snwd                -9.810      2.585  -3.794 0.000164 ***
FALSE avg_tmax                -9.623     38.201  -0.252 0.801211    
FALSE ---
FALSE Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
FALSE 
FALSE Residual standard error: 1585 on 579 degrees of freedom
FALSE Multiple R-squared:  0.5883,  Adjusted R-squared:  0.5747 
FALSE F-statistic: 43.54 on 19 and 579 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>#model_linear = step(model_linear_original, direction = &quot;backward&quot;)
#broom::tidy(model_linear) %&gt;% 
#  knitr::kable()


#summary(model_linear)</code></pre>
</div>
<div id="model-diagnostics" class="section level2">
<h2>Model diagnostics</h2>
<pre class="r"><code>set.seed(100)
par(mfrow=c(2,2))
plot(model_linear_original)</code></pre>
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code>anova(model_linear_original)</code></pre>
<pre><code>FALSE Analysis of Variance Table
FALSE 
FALSE Response: borough_monthly_cases
FALSE                   Df     Sum Sq   Mean Sq  F value    Pr(&gt;F)    
FALSE inspection_month  11   41484669   3771334   1.5020    0.1264    
FALSE borough            4 1726619254 431654814 171.9096 &lt; 2.2e-16 ***
FALSE covid_yn           1  260013862 260013862 103.5524 &lt; 2.2e-16 ***
FALSE avg_prcp           1    6558968   6558968   2.6122    0.1066    
FALSE avg_snwd           1   42272292  42272292  16.8352 4.662e-05 ***
FALSE avg_tmax           1     159323    159323   0.0635    0.8012    
FALSE Residuals        579 1453834829   2510941                       
FALSE ---
FALSE Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>outlierTest(model_linear_original)</code></pre>
<pre><code>##     rstudent unadjusted p-value Bonferroni p
## 312 4.345301         1.6431e-05    0.0098424</code></pre>
<pre class="r"><code>durbinWatsonTest(model_linear_original)</code></pre>
<pre><code>##  lag Autocorrelation D-W Statistic p-value
##    1       0.3309326      1.335503       0
##  Alternative hypothesis: rho != 0</code></pre>
<pre class="r"><code>vif(model_linear_original)</code></pre>
<pre><code>##                       GVIF Df GVIF^(1/(2*Df))
## inspection_month 34.855515 11        1.175177
## borough           1.005925  4        1.000739
## covid_yn          1.045793  1        1.022640
## avg_prcp          1.202117  1        1.096411
## avg_snwd          1.672248  1        1.293154
## avg_tmax         26.955318  1        5.191851</code></pre>
</div>
<div id="logistic-regression-model" class="section level2">
<h2>Logistic Regression Model</h2>
<p>We set the Result variable as the binary outcome. Passed(0) means
none was inspected.</p>
<pre class="r"><code>rat_binary = rat %&gt;% 
  select(result, borough, inspection_month, inspection_daytime, covid_yn, prcp, snow, snwd, tmin, tmax) %&gt;%
  mutate(inspection_result = case_when(
    result == &quot;Passed&quot; ~ 0, 
    TRUE ~ 1)) %&gt;%
  mutate(inspection_result = as.factor(inspection_result), 
         borough = as.factor(borough),
         covid_yn = as.factor(covid_yn),
         inspection_month = as.factor(inspection_month), 
         inspection_daytime = as.factor(inspection_daytime), 
         prcp = as.numeric(prcp), 
         snow = as.numeric(snow), 
         snwd = as.numeric(snwd),
         tmin = as.numeric(tmin), 
         tmax = as.numeric(tmax)) %&gt;%
  distinct()</code></pre>
<pre class="r"><code>model_logit_original = glm(inspection_result ~ inspection_month + borough + covid_yn + inspection_daytime + prcp + snow + snwd + tmin, data = rat_binary, family=&quot;binomial&quot;)

model_logit = step(model_logit_original, direction = &quot;backward&quot;)</code></pre>
<pre><code>## Start:  AIC=97187.13
## inspection_result ~ inspection_month + borough + covid_yn + inspection_daytime + 
##     prcp + snow + snwd + tmin
## 
##                      Df Deviance   AIC
## - inspection_month   11    97156 97180
## - tmin                1    97141 97185
## - snow                1    97142 97186
## &lt;none&gt;                     97141 97187
## - prcp                1    97146 97190
## - snwd                1    97155 97199
## - inspection_daytime  2    97166 97208
## - covid_yn            1    97183 97227
## - borough             4    97993 98031
## 
## Step:  AIC=97180.32
## inspection_result ~ borough + covid_yn + inspection_daytime + 
##     prcp + snow + snwd + tmin
## 
##                      Df Deviance   AIC
## - tmin                1    97158 97180
## - snow                1    97158 97180
## &lt;none&gt;                     97156 97180
## - prcp                1    97161 97183
## - snwd                1    97170 97192
## - inspection_daytime  2    97181 97201
## - covid_yn            1    97196 97218
## - borough             4    98007 98023
## 
## Step:  AIC=97179.83
## inspection_result ~ borough + covid_yn + inspection_daytime + 
##     prcp + snow + snwd
## 
##                      Df Deviance   AIC
## - snow                1    97159 97179
## &lt;none&gt;                     97158 97180
## - prcp                1    97163 97183
## - snwd                1    97171 97191
## - inspection_daytime  2    97182 97200
## - covid_yn            1    97199 97219
## - borough             4    98009 98023
## 
## Step:  AIC=97179.01
## inspection_result ~ borough + covid_yn + inspection_daytime + 
##     prcp + snwd
## 
##                      Df Deviance   AIC
## &lt;none&gt;                     97159 97179
## - prcp                1    97165 97183
## - snwd                1    97173 97191
## - inspection_daytime  2    97184 97200
## - covid_yn            1    97200 97218
## - borough             4    98010 98022</code></pre>
<pre class="r"><code>broom::tidy(model_logit) %&gt;% 
  knitr::kable()</code></pre>
<table style="width:100%;">
<colgroup>
<col width="37%" />
<col width="15%" />
<col width="14%" />
<col width="17%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">1.2790394</td>
<td align="right">0.0193928</td>
<td align="right">65.9545046</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">boroughBrooklyn</td>
<td align="right">-0.0051652</td>
<td align="right">0.0234838</td>
<td align="right">-0.2199475</td>
<td align="right">0.8259120</td>
</tr>
<tr class="odd">
<td align="left">boroughManhattan</td>
<td align="right">-0.0487682</td>
<td align="right">0.0236494</td>
<td align="right">-2.0621370</td>
<td align="right">0.0391947</td>
</tr>
<tr class="even">
<td align="left">boroughQueens</td>
<td align="right">-0.2777292</td>
<td align="right">0.0249150</td>
<td align="right">-11.1470549</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">boroughStaten Island</td>
<td align="right">-0.7026702</td>
<td align="right">0.0276150</td>
<td align="right">-25.4452509</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">covid_yn1</td>
<td align="right">-0.1415041</td>
<td align="right">0.0219299</td>
<td align="right">-6.4525569</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">inspection_daytimeMorning</td>
<td align="right">0.0797766</td>
<td align="right">0.0161027</td>
<td align="right">4.9542491</td>
<td align="right">0.0000007</td>
</tr>
<tr class="even">
<td align="left">inspection_daytimeNight</td>
<td align="right">0.0416545</td>
<td align="right">0.0426857</td>
<td align="right">0.9758404</td>
<td align="right">0.3291435</td>
</tr>
<tr class="odd">
<td align="left">prcp</td>
<td align="right">-0.0019379</td>
<td align="right">0.0008026</td>
<td align="right">-2.4144076</td>
<td align="right">0.0157608</td>
</tr>
<tr class="even">
<td align="left">snwd</td>
<td align="right">-0.0008454</td>
<td align="right">0.0002263</td>
<td align="right">-3.7364405</td>
<td align="right">0.0001866</td>
</tr>
</tbody>
</table>
<pre class="r"><code>summary(model_logit)</code></pre>
<pre><code>## 
## Call:
## glm(formula = inspection_result ~ borough + covid_yn + inspection_daytime + 
##     prcp + snwd, family = &quot;binomial&quot;, data = rat_binary)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.7819   0.6763   0.7008   0.7357   1.1420  
## 
## Coefficients:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                1.2790394  0.0193928  65.955  &lt; 2e-16 ***
## boroughBrooklyn           -0.0051652  0.0234838  -0.220 0.825912    
## boroughManhattan          -0.0487682  0.0236494  -2.062 0.039195 *  
## boroughQueens             -0.2777292  0.0249150 -11.147  &lt; 2e-16 ***
## boroughStaten Island      -0.7026702  0.0276150 -25.445  &lt; 2e-16 ***
## covid_yn1                 -0.1415041  0.0219299  -6.453 1.10e-10 ***
## inspection_daytimeMorning  0.0797766  0.0161027   4.954 7.26e-07 ***
## inspection_daytimeNight    0.0416545  0.0426857   0.976 0.329144    
## prcp                      -0.0019379  0.0008026  -2.414 0.015761 *  
## snwd                      -0.0008454  0.0002263  -3.736 0.000187 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 98083  on 88587  degrees of freedom
## Residual deviance: 97159  on 88578  degrees of freedom
## AIC: 97179
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<pre class="r"><code>anova(model_logit)</code></pre>
<pre><code>## Analysis of Deviance Table
## 
## Model: binomial, link: logit
## 
## Response: inspection_result
## 
## Terms added sequentially (first to last)
## 
## 
##                    Df Deviance Resid. Df Resid. Dev
## NULL                               88587      98083
## borough             4   842.19     88583      97241
## covid_yn            1    38.23     88582      97202
## inspection_daytime  2    24.51     88580      97178
## prcp                1     5.34     88579      97173
## snwd                1    13.51     88578      97159</code></pre>
<pre class="r"><code>set.seed(100)
par(mfrow=c(2,2))
plot(model_logit)</code></pre>
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code>anova(model_logit)</code></pre>
<pre><code>FALSE Analysis of Deviance Table
FALSE 
FALSE Model: binomial, link: logit
FALSE 
FALSE Response: inspection_result
FALSE 
FALSE Terms added sequentially (first to last)
FALSE 
FALSE 
FALSE                    Df Deviance Resid. Df Resid. Dev
FALSE NULL                               88587      98083
FALSE borough             4   842.19     88583      97241
FALSE covid_yn            1    38.23     88582      97202
FALSE inspection_daytime  2    24.51     88580      97178
FALSE prcp                1     5.34     88579      97173
FALSE snwd                1    13.51     88578      97159</code></pre>
</div>
<div id="merge-with-covid-19" class="section level2">
<h2>Merge with Covid-19</h2>
<pre class="r"><code>url_covid = &quot;https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_weather_covid.csv&quot;
rat_covid = read_csv(url_covid)</code></pre>
<pre><code>## New names:
## Rows: 155451 Columns: 26
## ── Column specification
## ───────────────────────────────────────── Delimiter: &quot;,&quot; chr
## (8): inspection_month, borough, inspection_type, block, lot,
## street_na... dbl (16): ...1, inspection_year, inspection_day,
## boro_code, zip_code, latit... time (2): inspection_time,
## approved_time
## ℹ Use `spec()` to retrieve the full column specification for
## this data. ℹ Specify the column types or set `show_col_types =
## FALSE` to quiet this message.
## • `` -&gt; `...1`</code></pre>
<pre class="r"><code>rat_covid = rat_covid %&gt;%
  mutate(inspection_month_n = case_when(inspection_month == &quot;Jan&quot; ~ 1,
                                   inspection_month == &quot;Feb&quot; ~ 2,
                                   inspection_month == &quot;Mar&quot; ~ 3,
                                   inspection_month == &quot;Apr&quot; ~ 4,
                                   inspection_month == &quot;May&quot; ~ 5,
                                   inspection_month == &quot;Jun&quot; ~ 6,
                                   inspection_month == &quot;Jul&quot; ~ 7,
                                   inspection_month == &quot;Aug&quot; ~ 8,
                                   inspection_month == &quot;Sep&quot; ~ 9,
                                   inspection_month == &quot;Oct&quot; ~ 10,
                                   inspection_month == &quot;Nov&quot; ~ 11,
                                   inspection_month == &quot;Dec&quot; ~ 12)) %&gt;%
  mutate(date = paste(inspection_year, inspection_month_n, inspection_day, sep = &quot;-&quot;))%&gt;%
  mutate(date = as.Date(date,format = &quot;%Y-%m-%d&quot;))</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
