<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Regression Analysis</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="icon" type="image/png" href="pic/rat.png"/>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NYC RAT INSPECTION</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="data_preprocessing.html">Data Preprocessing</a>
</li>
<li>
  <a href="exploratory_data_analysis.html">Exploratory Data Analysis</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Statistical Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="statistical_analysis.html">Hypothesis Test</a>
    </li>
    <li>
      <a href="regression_analysis.html">Regression Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="dashboard.html">Dashboard</a>
</li>
<li>
  <a href="https://lghtnpl.shinyapps.io/rat_app/">Shiny App</a>
</li>
<li>
  <a href="report.html">Report</a>
</li>
<li>
  <a href="https://youtube.com">
    <span class="fa fa-play-circle fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/YijiaJiang/nyc_rat_inspection">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Regression Analysis</h1>

</div>


<h1>
<strong>REGRESSION ANALYSIS</strong>
</h1>
<p> </p>
<p>In this section, we aimed to construct a linear regression model and
to generate the monthly number of rats observed using a variety of
potential predictors, along with the model diagnostics and model
validation. The regression model will be further utilized in the Shiny
App for the rat activity prediction. The outcome was defined as the
number of rat cases which were inspected in different borough per
month.</p>
<p> </p>
<p> </p>
<div id="exploratory-statistical-analyses" class="section level2">
<h2>Exploratory Statistical Analyses</h2>
<p>Before constructing the model, we performed the correlational
analysis to identify relevant variables and their impacts.</p>
<pre class="r"><code># correlation between key predictors
cases_borough_monthly %&gt;%
  dplyr::select(borough, inspection_month_n, avg_prcp, avg_snow, avg_snwd, avg_tmin, avg_tmax, avg_temp, covid_yn) %&gt;% 
  mutate(inspection_month_n = as.factor(inspection_month_n),
         covid_yn = as.factor(covid_yn)) %&gt;% 
  rename(
    &quot;Borough&quot; = borough,
    &quot;Month&quot; = inspection_month_n,
    &quot;Average Precipitation&quot; = avg_prcp,
    &quot;Average Snowfall&quot; = avg_snow,
    &quot;Average Snow Depth&quot; = avg_snwd,
    &quot;Average Tmin&quot; = avg_tmin,
    &quot;Average Tmax&quot; = avg_tmax,
    &quot;Average Temperature&quot; = avg_temp,
    &quot;COVID&quot; = covid_yn
  ) %&gt;% 
  ggpairs() + 
  scale_fill_discrete()</code></pre>
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-5-1.png" width="1536" /></p>
<p>Through the correlation analysis between key predictors, the result
above shown that the daily average temperature, the highest temperature,
and the lowest temperature are highly correlated between each other.</p>
<p> </p>
<pre class="r"><code># correlation between predictors and outcome
cases_borough_monthly %&gt;% 
  dplyr::select(boro_code, inspection_month_n, avg_prcp, avg_snow, avg_snwd, avg_tmin, avg_tmax, avg_temp, covid_yn, borough_monthly_cases) %&gt;%
  rename(
    &quot;Borough&quot; = boro_code,
    &quot;Month&quot; = inspection_month_n,
    &quot;Average Precipitation&quot; = avg_prcp,
    &quot;Average Snowfall&quot; = avg_snow,
    &quot;Average Snow Depth&quot; = avg_snwd,
    &quot;Average Tmin&quot; = avg_tmin,
    &quot;Average Tmax&quot; = avg_tmax,
    &quot;Average Temperature&quot; = avg_temp,
    &quot;COVID&quot; = covid_yn
  ) %&gt;% 
  cor_mat() %&gt;%
  cor_gather() %&gt;%
  filter(var1 %in% &quot;borough_monthly_cases&quot;) %&gt;%
  filter(!var2 %in% &quot;borough_monthly_cases&quot;) %&gt;%
  ggplot(aes(x = var1, y = var2, fill = cor, label = cor)) + 
  geom_tile(color = &quot;white&quot;) +   
  geom_text(color = &quot;white&quot;,size = 4) + 
  scale_x_discrete(labels = c(&quot;Borough Monthly cases&quot;)) + 
  labs(x = &quot;Outcome Variable&quot;, y = &quot;Predictor Variables&quot;,
       fill = &quot;Correlation&quot;)</code></pre>
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-6-1.png" width="576" /></p>
<p>Through the correlation analysis between predictors and outcome, the
result above shown that the borough was comparatively related to the
outcome.</p>
<p> </p>
<p> </p>
</div>
<div id="model-selection" class="section level2">
<h2>Model Selection</h2>
<div id="full-model" class="section level3">
<h3>Full Model</h3>
<pre class="r"><code># full model
cases_borough_monthly = cases_borough_monthly %&gt;% 
  mutate(inspection_month = month.abb[inspection_month_n],
         covid_yn = as.factor(covid_yn))


model_linear_full = lm(borough_monthly_cases ~ inspection_month + borough + covid_yn + avg_prcp + avg_snow + avg_snwd + avg_temp, data = cases_borough_monthly) 

broom::tidy(model_linear_full) %&gt;% 
   knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">4877.56152</td>
<td align="right">579.615793</td>
<td align="right">8.4151633</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">inspection_monthAug</td>
<td align="right">-23.75773</td>
<td align="right">641.514627</td>
<td align="right">-0.0370338</td>
<td align="right">0.9704709</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthDec</td>
<td align="right">-315.92270</td>
<td align="right">422.890928</td>
<td align="right">-0.7470548</td>
<td align="right">0.4553353</td>
</tr>
<tr class="even">
<td align="left">inspection_monthFeb</td>
<td align="right">110.61065</td>
<td align="right">464.226729</td>
<td align="right">0.2382686</td>
<td align="right">0.8117575</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthJan</td>
<td align="right">-704.79392</td>
<td align="right">521.621933</td>
<td align="right">-1.3511585</td>
<td align="right">0.1771751</td>
</tr>
<tr class="even">
<td align="left">inspection_monthJul</td>
<td align="right">-297.34069</td>
<td align="right">680.360646</td>
<td align="right">-0.4370339</td>
<td align="right">0.6622505</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthJun</td>
<td align="right">-132.07181</td>
<td align="right">547.714939</td>
<td align="right">-0.2411324</td>
<td align="right">0.8095383</td>
</tr>
<tr class="even">
<td align="left">inspection_monthMar</td>
<td align="right">213.70290</td>
<td align="right">378.803232</td>
<td align="right">0.5641528</td>
<td align="right">0.5728698</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthMay</td>
<td align="right">-204.76235</td>
<td align="right">407.848043</td>
<td align="right">-0.5020555</td>
<td align="right">0.6158203</td>
</tr>
<tr class="even">
<td align="left">inspection_monthNov</td>
<td align="right">-601.71179</td>
<td align="right">351.213875</td>
<td align="right">-1.7132347</td>
<td align="right">0.0872075</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthOct</td>
<td align="right">-528.97590</td>
<td align="right">357.576370</td>
<td align="right">-1.4793368</td>
<td align="right">0.1395970</td>
</tr>
<tr class="even">
<td align="left">inspection_monthSep</td>
<td align="right">-347.95599</td>
<td align="right">516.984759</td>
<td align="right">-0.6730488</td>
<td align="right">0.5011862</td>
</tr>
<tr class="odd">
<td align="left">boroughBrooklyn</td>
<td align="right">-202.80772</td>
<td align="right">205.202472</td>
<td align="right">-0.9883298</td>
<td align="right">0.3234061</td>
</tr>
<tr class="even">
<td align="left">boroughManhattan</td>
<td align="right">234.56147</td>
<td align="right">204.704306</td>
<td align="right">1.1458551</td>
<td align="right">0.2523309</td>
</tr>
<tr class="odd">
<td align="left">boroughQueens</td>
<td align="right">-3006.29996</td>
<td align="right">205.573090</td>
<td align="right">-14.6239956</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">boroughStaten Island</td>
<td align="right">-3867.04047</td>
<td align="right">205.489319</td>
<td align="right">-18.8186933</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">covid_yn1</td>
<td align="right">-1666.86661</td>
<td align="right">167.384645</td>
<td align="right">-9.9583006</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">avg_prcp</td>
<td align="right">38.26454</td>
<td align="right">28.695437</td>
<td align="right">1.3334712</td>
<td align="right">0.1829043</td>
</tr>
<tr class="odd">
<td align="left">avg_snow</td>
<td align="right">-51.98910</td>
<td align="right">35.077476</td>
<td align="right">-1.4821220</td>
<td align="right">0.1388547</td>
</tr>
<tr class="even">
<td align="left">avg_snwd</td>
<td align="right">-10.62638</td>
<td align="right">2.667413</td>
<td align="right">-3.9837775</td>
<td align="right">0.0000765</td>
</tr>
<tr class="odd">
<td align="left">avg_temp</td>
<td align="right">-10.29318</td>
<td align="right">42.849578</td>
<td align="right">-0.2402165</td>
<td align="right">0.8102479</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#summary(model_linear_full)</code></pre>
<p>The full multiple linear regression model we constructed is</p>
<p><span class="math inline">\(borough\_monthly\_cases= \beta_0+
\beta_1(inspectionMonth) + \beta_2(borough) + \beta_3(covid) +
\beta_4(avg\_precipitaiton) + \\\beta_5(avg\_snowFall) +
\beta_6(avg\_snowDepth) + \beta_7(avg\_temperature)\)</span>.</p>
<p>The result shown that the p-value of <code>inspectionMonth</code>,
<code>avg_precipitaiton</code>, <code>avg_snowFall</code>, and
<code>avg_temperature</code> were greater than 0.05, which had to be
analyzed by stepwise regression method.</p>
<p> </p>
<p> </p>
</div>
<div id="stepwise-selection-in-full-model" class="section level3">
<h3>Stepwise Selection in Full Model</h3>
<pre class="r"><code># stepwise with AIC (full model)
model_linear = step(model_linear_full, direction = &quot;both&quot;)</code></pre>
<pre><code>## Start:  AIC=8818.76
## borough_monthly_cases ~ inspection_month + borough + covid_yn + 
##     avg_prcp + avg_snow + avg_snwd + avg_temp
## 
##                    Df  Sum of Sq        RSS    AIC
## - inspection_month 11   41374644 1489241909 8813.6
## - avg_temp          1     145048 1448012313 8816.8
## - avg_prcp          1    4469650 1452336915 8818.6
## &lt;none&gt;                           1447867265 8818.8
## - avg_snow          1    5521717 1453388982 8819.0
## - avg_snwd          1   39892974 1487760239 8833.0
## - covid_yn          1  249273854 1697141119 8911.6
## - borough           4 1745919405 3193786670 9283.1
## 
## Step:  AIC=8813.58
## borough_monthly_cases ~ borough + covid_yn + avg_prcp + avg_snow + 
##     avg_snwd + avg_temp
## 
##                    Df  Sum of Sq        RSS    AIC
## - avg_temp          1     645366 1489887275 8811.8
## - avg_prcp          1    3462718 1492704627 8813.0
## &lt;none&gt;                           1489241909 8813.6
## - avg_snow          1    6676451 1495918360 8814.3
## + inspection_month 11   41374644 1447867265 8818.8
## - avg_snwd          1   38346768 1527588677 8826.8
## - covid_yn          1  259704790 1748946698 8907.5
## - borough           4 1747059666 3236301575 9269.0
## 
## Step:  AIC=8811.84
## borough_monthly_cases ~ borough + covid_yn + avg_prcp + avg_snow + 
##     avg_snwd
## 
##                    Df  Sum of Sq        RSS    AIC
## - avg_prcp          1    2913533 1492800808 8811.0
## &lt;none&gt;                           1489887275 8811.8
## - avg_snow          1    6126822 1496014097 8812.3
## + avg_temp          1     645366 1489241909 8813.6
## + inspection_month 11   41874962 1448012313 8816.8
## - avg_snwd          1   38649953 1528537228 8825.1
## - covid_yn          1  259622598 1749509873 8905.7
## - borough           4 1746841348 3236728623 9267.0
## 
## Step:  AIC=8811.01
## borough_monthly_cases ~ borough + covid_yn + avg_snow + avg_snwd
## 
##                    Df  Sum of Sq        RSS    AIC
## &lt;none&gt;                           1492800808 8811.0
## - avg_snow          1    6041412 1498842220 8811.4
## + avg_prcp          1    2913533 1489887275 8811.8
## + avg_temp          1      96181 1492704627 8813.0
## + inspection_month 11   40305045 1452495763 8816.7
## - avg_snwd          1   42278134 1535078942 8825.7
## - covid_yn          1  256710249 1749511057 8903.7
## - borough           4 1744255398 3237056206 9265.1</code></pre>
<pre class="r"><code>#model_linear = lm(borough_monthly_cases ~ borough + covid_yn + avg_snow + avg_snwd, data = cases_borough_monthly) 

 
 broom::tidy(model_linear) %&gt;% 
   knitr::kable()</code></pre>
<table>
<colgroup>
<col width="31%" />
<col width="19%" />
<col width="16%" />
<col width="17%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">4591.358111</td>
<td align="right">152.021884</td>
<td align="right">30.2019550</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">boroughBrooklyn</td>
<td align="right">-200.567381</td>
<td align="right">206.009043</td>
<td align="right">-0.9735853</td>
<td align="right">0.3306621</td>
</tr>
<tr class="odd">
<td align="left">boroughManhattan</td>
<td align="right">234.744781</td>
<td align="right">205.536729</td>
<td align="right">1.1421062</td>
<td align="right">0.2538739</td>
</tr>
<tr class="even">
<td align="left">boroughQueens</td>
<td align="right">-2994.362259</td>
<td align="right">206.069683</td>
<td align="right">-14.5308238</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">boroughStaten Island</td>
<td align="right">-3855.169862</td>
<td align="right">206.046700</td>
<td align="right">-18.7101753</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">covid_yn1</td>
<td align="right">-1652.726053</td>
<td align="right">164.218678</td>
<td align="right">-10.0641783</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">avg_snow</td>
<td align="right">-47.282100</td>
<td align="right">30.624628</td>
<td align="right">-1.5439241</td>
<td align="right">0.1231438</td>
</tr>
<tr class="even">
<td align="left">avg_snwd</td>
<td align="right">-8.338283</td>
<td align="right">2.041559</td>
<td align="right">-4.0842717</td>
<td align="right">0.0000503</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#summary(model_linear)</code></pre>
<p>We eliminated those variables that are not statistically significant
using stepwise regression: <span
class="math inline">\(borough\_monthly\_cases= \beta_0+ \beta_1(borough)
+ \beta_2(covid) + \beta_3(snowFall) + \beta_4(snowDepth)\)</span></p>
<p> </p>
<p> </p>
</div>
<div id="full-model-with-log-transformation" class="section level3">
<h3>Full Model with Log Transformation</h3>
<pre class="r"><code># full model with log transformation
model_linear_full_log = lm(log(borough_monthly_cases) ~ inspection_month + borough + covid_yn + avg_prcp + avg_snow + avg_snwd + avg_temp, data = cases_borough_monthly) 

 broom::tidy(model_linear_full_log) %&gt;% 
   knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">7.6477113</td>
<td align="right">0.2539622</td>
<td align="right">30.1135775</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">inspection_monthAug</td>
<td align="right">-0.3615819</td>
<td align="right">0.2810836</td>
<td align="right">-1.2863857</td>
<td align="right">0.1988253</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthDec</td>
<td align="right">0.4088321</td>
<td align="right">0.1852923</td>
<td align="right">2.2064177</td>
<td align="right">0.0277486</td>
</tr>
<tr class="even">
<td align="left">inspection_monthFeb</td>
<td align="right">0.7266223</td>
<td align="right">0.2034038</td>
<td align="right">3.5723141</td>
<td align="right">0.0003834</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthJan</td>
<td align="right">0.4531600</td>
<td align="right">0.2285519</td>
<td align="right">1.9827449</td>
<td align="right">0.0478705</td>
</tr>
<tr class="even">
<td align="left">inspection_monthJul</td>
<td align="right">-0.5593521</td>
<td align="right">0.2981042</td>
<td align="right">-1.8763644</td>
<td align="right">0.0611106</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthJun</td>
<td align="right">-0.3652389</td>
<td align="right">0.2399847</td>
<td align="right">-1.5219258</td>
<td align="right">0.1285764</td>
</tr>
<tr class="even">
<td align="left">inspection_monthMar</td>
<td align="right">0.6400278</td>
<td align="right">0.1659750</td>
<td align="right">3.8561705</td>
<td align="right">0.0001282</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthMay</td>
<td align="right">-0.2591338</td>
<td align="right">0.1787011</td>
<td align="right">-1.4500961</td>
<td align="right">0.1475760</td>
</tr>
<tr class="even">
<td align="left">inspection_monthNov</td>
<td align="right">0.1890598</td>
<td align="right">0.1538865</td>
<td align="right">1.2285663</td>
<td align="right">0.2197362</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthOct</td>
<td align="right">-0.2114703</td>
<td align="right">0.1566743</td>
<td align="right">-1.3497451</td>
<td align="right">0.1776280</td>
</tr>
<tr class="even">
<td align="left">inspection_monthSep</td>
<td align="right">-0.3436626</td>
<td align="right">0.2265201</td>
<td align="right">-1.5171400</td>
<td align="right">0.1297800</td>
</tr>
<tr class="odd">
<td align="left">boroughBrooklyn</td>
<td align="right">-0.0834743</td>
<td align="right">0.0899107</td>
<td align="right">-0.9284128</td>
<td align="right">0.3535823</td>
</tr>
<tr class="even">
<td align="left">boroughManhattan</td>
<td align="right">0.0131220</td>
<td align="right">0.0896925</td>
<td align="right">0.1462998</td>
<td align="right">0.8837359</td>
</tr>
<tr class="odd">
<td align="left">boroughQueens</td>
<td align="right">-1.2875829</td>
<td align="right">0.0900731</td>
<td align="right">-14.2948631</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">boroughStaten Island</td>
<td align="right">-2.5866328</td>
<td align="right">0.0900364</td>
<td align="right">-28.7287423</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">covid_yn1</td>
<td align="right">-1.0490882</td>
<td align="right">0.0733406</td>
<td align="right">-14.3043274</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">avg_prcp</td>
<td align="right">0.0320634</td>
<td align="right">0.0125731</td>
<td align="right">2.5501635</td>
<td align="right">0.0110250</td>
</tr>
<tr class="odd">
<td align="left">avg_snow</td>
<td align="right">-0.0204332</td>
<td align="right">0.0153694</td>
<td align="right">-1.3294727</td>
<td align="right">0.1842184</td>
</tr>
<tr class="even">
<td align="left">avg_snwd</td>
<td align="right">-0.0050600</td>
<td align="right">0.0011687</td>
<td align="right">-4.3294482</td>
<td align="right">0.0000176</td>
</tr>
<tr class="odd">
<td align="left">avg_temp</td>
<td align="right">0.0460598</td>
<td align="right">0.0187748</td>
<td align="right">2.4532764</td>
<td align="right">0.0144514</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#summary(model_linear_full_log)</code></pre>
<p>Log transformation was applied to our model to improve validity,
additivity, and linearity: <span
class="math inline">\(log(borough\_monthly\_cases)= \beta_0+
\beta_1(inspectionMonth) + \beta_2(borough) + \beta_3(covid) +
\beta_4(avg\_precipitaiton) + \\\beta_5(avg\_snowFall) +
\beta_6(avg\_snowDepth) + \beta_7(avg\_temperature)\)</span></p>
<p> </p>
<p> </p>
</div>
<div id="stepwise-selection-in-full-model-with-log-transformation"
class="section level3">
<h3>Stepwise Selection in Full Model with Log Transformation</h3>
<pre class="r"><code># stepwise with AIC
model_linear_log = step(model_linear_full_log, direction = &quot;both&quot;)</code></pre>
<pre><code>## Start:  AIC=-414.36
## log(borough_monthly_cases) ~ inspection_month + borough + covid_yn + 
##     avg_prcp + avg_snow + avg_snwd + avg_temp
## 
##                    Df Sum of Sq    RSS     AIC
## - avg_snow          1      0.85 278.82 -414.54
## &lt;none&gt;                          277.96 -414.36
## - avg_temp          1      2.90 280.87 -410.16
## - avg_prcp          1      3.14 281.10 -409.66
## - inspection_month 11     14.44 292.41 -406.12
## - avg_snwd          1      9.05 287.01 -397.25
## - covid_yn          1     98.74 376.70 -234.89
## - borough           4    622.04 900.00  279.06
## 
## Step:  AIC=-414.54
## log(borough_monthly_cases) ~ inspection_month + borough + covid_yn + 
##     avg_prcp + avg_snwd + avg_temp
## 
##                    Df Sum of Sq    RSS     AIC
## &lt;none&gt;                          278.82 -414.54
## + avg_snow          1      0.85 277.96 -414.36
## - avg_prcp          1      2.83 281.65 -410.50
## - avg_temp          1      3.93 282.74 -408.18
## - inspection_month 11     14.63 293.44 -406.01
## - avg_snwd          1      9.01 287.83 -397.54
## - covid_yn          1     98.67 377.49 -235.65
## - borough           4    621.21 900.02  277.07</code></pre>
<pre class="r"><code>#model_linear_log = lm(log(borough_monthly_cases) ~ inspection_month + borough + covid_yn + avg_prcp + avg_snwd + avg_temp, data = cases_borough_monthly) 


 broom::tidy(model_linear_log) %&gt;% 
   knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">7.5745005</td>
<td align="right">0.2480849</td>
<td align="right">30.5318842</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">inspection_monthAug</td>
<td align="right">-0.4343765</td>
<td align="right">0.2758823</td>
<td align="right">-1.5744994</td>
<td align="right">0.1159202</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthDec</td>
<td align="right">0.4159713</td>
<td align="right">0.1853376</td>
<td align="right">2.2443983</td>
<td align="right">0.0251850</td>
</tr>
<tr class="even">
<td align="left">inspection_monthFeb</td>
<td align="right">0.7533430</td>
<td align="right">0.2025429</td>
<td align="right">3.7194235</td>
<td align="right">0.0002192</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthJan</td>
<td align="right">0.4587210</td>
<td align="right">0.2286655</td>
<td align="right">2.0060786</td>
<td align="right">0.0453141</td>
</tr>
<tr class="even">
<td align="left">inspection_monthJul</td>
<td align="right">-0.6331118</td>
<td align="right">0.2930907</td>
<td align="right">-2.1601225</td>
<td align="right">0.0311743</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthJun</td>
<td align="right">-0.4220892</td>
<td align="right">0.2363012</td>
<td align="right">-1.7862338</td>
<td align="right">0.0745864</td>
</tr>
<tr class="even">
<td align="left">inspection_monthMar</td>
<td align="right">0.6309198</td>
<td align="right">0.1659438</td>
<td align="right">3.8020096</td>
<td align="right">0.0001588</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthMay</td>
<td align="right">-0.2891064</td>
<td align="right">0.1773912</td>
<td align="right">-1.6297677</td>
<td align="right">0.1036963</td>
</tr>
<tr class="even">
<td align="left">inspection_monthNov</td>
<td align="right">0.1915228</td>
<td align="right">0.1539777</td>
<td align="right">1.2438347</td>
<td align="right">0.2140655</td>
</tr>
<tr class="odd">
<td align="left">inspection_monthOct</td>
<td align="right">-0.2292118</td>
<td align="right">0.1562087</td>
<td align="right">-1.4673432</td>
<td align="right">0.1428276</td>
</tr>
<tr class="even">
<td align="left">inspection_monthSep</td>
<td align="right">-0.3929611</td>
<td align="right">0.2236129</td>
<td align="right">-1.7573275</td>
<td align="right">0.0793923</td>
</tr>
<tr class="odd">
<td align="left">boroughBrooklyn</td>
<td align="right">-0.0804943</td>
<td align="right">0.0899425</td>
<td align="right">-0.8949529</td>
<td align="right">0.3711855</td>
</tr>
<tr class="even">
<td align="left">boroughManhattan</td>
<td align="right">0.0146582</td>
<td align="right">0.0897446</td>
<td align="right">0.1633318</td>
<td align="right">0.8703144</td>
</tr>
<tr class="odd">
<td align="left">boroughQueens</td>
<td align="right">-1.2822084</td>
<td align="right">0.0900422</td>
<td align="right">-14.2400861</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">boroughStaten Island</td>
<td align="right">-2.5816659</td>
<td align="right">0.0900187</td>
<td align="right">-28.6792259</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">covid_yn1</td>
<td align="right">-1.0487221</td>
<td align="right">0.0733889</td>
<td align="right">-14.2899364</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">avg_prcp</td>
<td align="right">0.0302926</td>
<td align="right">0.0125106</td>
<td align="right">2.4213463</td>
<td align="right">0.0157705</td>
</tr>
<tr class="odd">
<td align="left">avg_snwd</td>
<td align="right">-0.0050514</td>
<td align="right">0.0011695</td>
<td align="right">-4.3192825</td>
<td align="right">0.0000184</td>
</tr>
<tr class="even">
<td align="left">avg_temp</td>
<td align="right">0.0520163</td>
<td align="right">0.0182445</td>
<td align="right">2.8510664</td>
<td align="right">0.0045132</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#summary(model_linear_log)</code></pre>
<p>Same as the original linear model above, we also applied the stepwise
selection and got the final model: <span
class="math inline">\(log(borough\_monthly\_cases)= \beta_0+
\beta_1(inspectionMonth) + \beta_2(borough) + \beta_3(covid) +
\beta_4(avg\_precipitaiton)+ \\\beta_5(avg\_snowDepth) +
\beta_6(avg\_temperature)\)</span></p>
<p> </p>
<p> </p>
</div>
</div>
<div id="model-diagnostics" class="section level2">
<h2>Model Diagnostics</h2>
<pre class="r"><code>performance::check_model(model_linear, check = c(&quot;linearity&quot;, &quot;qq&quot;, &quot;normality&quot;, &quot;outliers&quot;, &quot;homogeneity&quot;, &quot;vif&quot;))</code></pre>
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-11-1.png" width="960" /></p>
<pre class="r"><code>performance::check_model(model_linear_log, check = c(&quot;linearity&quot;, &quot;qq&quot;, &quot;normality&quot;, &quot;outliers&quot;, &quot;homogeneity&quot;, &quot;vif&quot;))</code></pre>
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-12-1.png" width="960" /></p>
<p>According to plots above, we can see that linearity, homogeneity, and
normality of residuals were all improved after the log transformation.
Residuals were distributed around the 0 horizontal line and the
reference line was flatter. There was no influential points outside the
contour lines. Also, the residuals were approximately normally
distributed.</p>
<p> </p>
<p> </p>
</div>
<div id="cross-validation" class="section level2">
<h2>Cross-validation</h2>
<pre class="r"><code># cross-validation 
set.seed(2022)

# without log
cv_df_1 = 
  crossv_mc(cases_borough_monthly, 100) %&gt;% 
    mutate(
        train = map(train, as_tibble),
        test = map(test,as_tibble)
    )  %&gt;%
  mutate(
    model_fit1  = map(train, ~lm(borough_monthly_cases ~ inspection_month + borough + covid_yn + avg_prcp + avg_snow + avg_snwd + avg_temp, data = .x)),
    model_fit2  = map(train, ~lm(borough_monthly_cases ~ borough + covid_yn + avg_snow + avg_snwd, data = .x))) %&gt;% 
  mutate(
    rmse_1 = map2_dbl(model_fit1, test, ~rmse(model = .x, data = .y)),
    rmse_2 = map2_dbl(model_fit2, test, ~rmse(model = .x, data = .y))) 

p_cv_1 = cv_df_1 %&gt;% 
  select(starts_with(&quot;rmse&quot;)) %&gt;% 
  pivot_longer(
    everything(),
    names_to = &quot;model&quot;, 
    values_to = &quot;rmse&quot;,
    names_prefix = &quot;rmse_&quot;) %&gt;% 
  mutate(model = fct_inorder(model)) %&gt;% 
  ggplot(aes(x = model, y = rmse)) + 
  geom_violin() +
  labs(title = &quot;Comparison of the Cross-Validated Prediction Error&quot;, 
       x = &quot;Models&quot;, 
       y = &quot;Root Mean Square Error (RMSE)&quot;)  +
  scale_x_discrete(labels = c(&quot;Full Model&quot;, &quot;Stepwise Model&quot;)) 

# log
cv_df_2 = 
  crossv_mc(cases_borough_monthly, 100) %&gt;% 
    mutate(
        train = map(train, as_tibble),
        test = map(test,as_tibble)
    )  %&gt;%
  mutate(
    model_fit3  = map(train, ~lm(log(borough_monthly_cases) ~ inspection_month + borough + covid_yn + avg_prcp + avg_snow + avg_snwd + avg_temp, data = .x)),
    model_fit4  = map(train, ~lm(log(borough_monthly_cases) ~ inspection_month + borough + covid_yn + avg_prcp + avg_snwd + avg_temp, data = .x))) %&gt;% 
  mutate(
    rmse_3 = map2_dbl(model_fit3, test, ~rmse(model = .x, data = .y)),
    rmse_4 = map2_dbl(model_fit4, test, ~rmse(model = .x, data = .y))) 

p_cv_2 = cv_df_2 %&gt;% 
  select(starts_with(&quot;rmse&quot;)) %&gt;% 
  pivot_longer(
    everything(),
    names_to = &quot;model&quot;, 
    values_to = &quot;rmse&quot;,
    names_prefix = &quot;rmse_&quot;) %&gt;% 
  mutate(model = fct_inorder(model)) %&gt;% 
  ggplot(aes(x = model, y = rmse)) + 
  geom_violin() +
  labs(title = &quot;Comparison of the Cross-Validated Prediction Error&quot;, 
       x = &quot;Models&quot;, 
       y = &quot;Root Mean Square Error (RMSE)&quot;)  +
  scale_x_discrete(labels = c(&quot;Full Model (Log)&quot;, &quot;Stepwise Model (Log)&quot;)) 


p_cv_1 / p_cv_2</code></pre>
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>According to the plot, there was a significant difference on RMSE
between models with and without log-transformed outcomes. Model with
log-transformation had a substantially lower average value of RMSE,
which means this type of model better fits. After stepwise selection,
only one variable was dropped and the RMSE were similar. We preferred
the model with less variables to avoid potential over-fit.</p>
<p> </p>
<p> </p>
</div>
<div id="summaries" class="section level2">
<h2>Summaries</h2>
<p>The model diagnostics result shown linearity and normality were
relatively improved after the log transformation and the stepwise
regression. Therefore, we concluded that the number of rat inspection
would be affected by borough, COVID-19, and inspection time, also
positively correlated with the precipitation and environment
temperature, negatively related with the snow depth on the inspection
date.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
