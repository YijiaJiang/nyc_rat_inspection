---
title: "Regression"
output: 
  html_document:
    toc: true
    toc_float: 
      toc_collapsed: true
    toc_depth: 5
    code_folding: hide
---

```{r message = FALSE, warning = FALSE}
library(tidyverse)
library(readxl)
```


```{r message = FALSE, warning = FALSE}
url_2012 = "https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2012.csv"
rat_2012 = read_csv(url(url_2012)) 
url_2013 = "https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2013.csv"
rat_2013 = read_csv(url(url_2013)) 
url_2014 = "https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2014.csv"
rat_2014 = read_csv(url(url_2014)) 
url_2015 = "https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2015.csv"
rat_2015 = read_csv(url(url_2015)) 
url_2016 = "https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2016.csv"
rat_2016 = read_csv(url(url_2016)) 
url_2017 = "https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2017.csv"
rat_2017 = read_csv(url(url_2017)) 
url_2018 = "https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2018.csv"
rat_2018 = read_csv(url(url_2018)) 
url_2019 = "https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2019.csv"
rat_2019 = read_csv(url(url_2019)) 
url_2020 = "https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2020.csv"
rat_2020 = read_csv(url(url_2020)) 
url_2021 = "https://raw.githubusercontent.com/YijiaJiang/p8105_final_project_data/main/rat_2021.csv"
rat_2021 = read_csv(url(url_2021)) 
```

```{r}
rat = bind_rows(rat_2012, rat_2013, rat_2014, rat_2015, rat_2016, rat_2017, rat_2018, rat_2019, rat_2020, rat_2021) %>%
  select(-...1) %>%
   mutate(inspection_month_n = recode(inspection_month, 
                                   "Jan" = 1,
                                   "Feb" = 2,
                                   "Mar" = 3,
                                   "Apr" = 4,
                                   "May" = 5,
                                   "Jun" = 6,
                                   "Jul" = 7,
                                   "Aug" = 8,
                                   "Sep" = 9,
                                   "Oct" = 10,
                                   "Nov" = 11,
                                   "Dec" = 12)) %>%
  mutate(date = paste(inspection_year, inspection_month_n, inspection_day, sep = "-")) %>%
  mutate(date = as.Date(date,format = "%Y-%m-%d")) %>% 
  mutate(inspection_ym = paste(inspection_year, inspection_month_n)) %>%
  filter(result != "Passed")
```

```{r}
cases = rat %>% 
  select(inspection_ym, borough) %>% 
  group_by(inspection_ym, borough) %>% 
  add_count(borough, inspection_ym, name = "borough_month_cases") %>%
  distinct()
rat_tidy = rat %>% 
  select(borough, inspection_ym, inspection_month, prcp, snow, snwd, tmin, tmax) %>%
  mutate(borough = as.factor(borough), inspection_month = as.factor(inspection_month), 
         prcp = as.numeric(prcp), snow = as.numeric(snow), snwd = as.numeric(snwd),
         tmin = as.numeric(tmin), tmax = as.numeric(tmax)) 
cases_borough_month = merge(x = rat_tidy, y = cases, by = c("inspection_ym", "borough")) %>%distinct() 
```

```{r}
  
original_lm = lm(borough_month_cases ~ inspection_month + borough + prcp + snow + snwd + tmin + tmax, data = cases_borough_month) 
broom::tidy(original_lm) %>% 
  knitr::kable()

step_lm = step(original_lm, direction = "backward")
broom::tidy(step_lm) %>% 
  knitr::kable()


#model_interact = lm(borough_month_cases ~ inspection_month + borough + snow + prcp + snwd + tmin + tmax , data = cases_borough_month) 
#broom::tidy(model_interact) %>% knitr::kable()
```

```{r, message = FALSE, warning = FALSE,comment = FALSE}

```


```{r, message = FALSE, warning = FALSE,comment = FALSE}
set.seed(100)
plot(step_lm)
```